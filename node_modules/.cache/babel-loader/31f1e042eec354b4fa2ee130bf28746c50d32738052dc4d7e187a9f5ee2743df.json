{"ast":null,"code":"import React,{useEffect,useState}from'react';import{Navigate}from'react-router-dom';import{Spinner}from'@heroui/react';import{isAuthenticated}from'../config';import{authApi}from'../services/api';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const ProtectedRoute=_ref=>{let{children}=_ref;const[isLoading,setIsLoading]=useState(true);const[isValid,setIsValid]=useState(false);useEffect(()=>{const validateAuth=async()=>{// 如果没有token，直接重定向到登录页\nif(!isAuthenticated()){setIsLoading(false);return;}try{// 验证token有效性\nawait authApi.validateToken();setIsValid(true);}catch(error){console.error('Token validation failed:',error);setIsValid(false);}finally{setIsLoading(false);}};validateAuth();},[]);if(isLoading){return/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',justifyContent:'center',minHeight:'100vh',flexDirection:'column',gap:'16px'},children:[/*#__PURE__*/_jsx(Spinner,{size:\"lg\",color:\"primary\"}),/*#__PURE__*/_jsx(\"div\",{style:{color:'#6b7280',fontSize:'14px'},children:\"\\u9A8C\\u8BC1\\u767B\\u5F55\\u72B6\\u6001...\"})]});}if(!isAuthenticated()||!isValid){return/*#__PURE__*/_jsx(Navigate,{to:\"/admin/login\",replace:true});}return/*#__PURE__*/_jsx(_Fragment,{children:children});};export default ProtectedRoute;","map":{"version":3,"names":["React","useEffect","useState","Navigate","Spinner","isAuthenticated","authApi","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","ProtectedRoute","_ref","children","isLoading","setIsLoading","isValid","setIsValid","validateAuth","validateToken","error","console","style","display","alignItems","justifyContent","minHeight","flexDirection","gap","size","color","fontSize","to","replace"],"sources":["/opt/dev/star_share/web/src/components/ProtectedRoute.tsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { Navigate } from 'react-router-dom';\nimport { Spinner } from '@heroui/react';\nimport { isAuthenticated } from '../config';\nimport { authApi } from '../services/api';\n\ninterface ProtectedRouteProps {\n  children: React.ReactNode;\n}\n\nconst ProtectedRoute: React.FC<ProtectedRouteProps> = ({ children }) => {\n  const [isLoading, setIsLoading] = useState(true);\n  const [isValid, setIsValid] = useState(false);\n\n  useEffect(() => {\n    const validateAuth = async () => {\n      // 如果没有token，直接重定向到登录页\n      if (!isAuthenticated()) {\n        setIsLoading(false);\n        return;\n      }\n\n      try {\n        // 验证token有效性\n        await authApi.validateToken();\n        setIsValid(true);\n      } catch (error) {\n        console.error('Token validation failed:', error);\n        setIsValid(false);\n      } finally {\n        setIsLoading(false);\n      }\n    };\n\n    validateAuth();\n  }, []);\n\n  if (isLoading) {\n    return (\n      <div style={{ \n        display: 'flex', \n        alignItems: 'center', \n        justifyContent: 'center', \n        minHeight: '100vh',\n        flexDirection: 'column',\n        gap: '16px'\n      }}>\n        <Spinner size=\"lg\" color=\"primary\" />\n        <div style={{ color: '#6b7280', fontSize: '14px' }}>验证登录状态...</div>\n      </div>\n    );\n  }\n\n  if (!isAuthenticated() || !isValid) {\n    return <Navigate to=\"/admin/login\" replace />;\n  }\n\n  return <>{children}</>;\n};\n\nexport default ProtectedRoute;"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,SAAS,CAAEC,QAAQ,KAAQ,OAAO,CAClD,OAASC,QAAQ,KAAQ,kBAAkB,CAC3C,OAASC,OAAO,KAAQ,eAAe,CACvC,OAASC,eAAe,KAAQ,WAAW,CAC3C,OAASC,OAAO,KAAQ,iBAAiB,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,CAAAC,QAAA,IAAAC,SAAA,yBAM1C,KAAM,CAAAC,cAA6C,CAAGC,IAAA,EAAkB,IAAjB,CAAEC,QAAS,CAAC,CAAAD,IAAA,CACjE,KAAM,CAACE,SAAS,CAAEC,YAAY,CAAC,CAAGf,QAAQ,CAAC,IAAI,CAAC,CAChD,KAAM,CAACgB,OAAO,CAAEC,UAAU,CAAC,CAAGjB,QAAQ,CAAC,KAAK,CAAC,CAE7CD,SAAS,CAAC,IAAM,CACd,KAAM,CAAAmB,YAAY,CAAG,KAAAA,CAAA,GAAY,CAC/B;AACA,GAAI,CAACf,eAAe,CAAC,CAAC,CAAE,CACtBY,YAAY,CAAC,KAAK,CAAC,CACnB,OACF,CAEA,GAAI,CACF;AACA,KAAM,CAAAX,OAAO,CAACe,aAAa,CAAC,CAAC,CAC7BF,UAAU,CAAC,IAAI,CAAC,CAClB,CAAE,MAAOG,KAAK,CAAE,CACdC,OAAO,CAACD,KAAK,CAAC,0BAA0B,CAAEA,KAAK,CAAC,CAChDH,UAAU,CAAC,KAAK,CAAC,CACnB,CAAC,OAAS,CACRF,YAAY,CAAC,KAAK,CAAC,CACrB,CACF,CAAC,CAEDG,YAAY,CAAC,CAAC,CAChB,CAAC,CAAE,EAAE,CAAC,CAEN,GAAIJ,SAAS,CAAE,CACb,mBACEN,KAAA,QAAKc,KAAK,CAAE,CACVC,OAAO,CAAE,MAAM,CACfC,UAAU,CAAE,QAAQ,CACpBC,cAAc,CAAE,QAAQ,CACxBC,SAAS,CAAE,OAAO,CAClBC,aAAa,CAAE,QAAQ,CACvBC,GAAG,CAAE,MACP,CAAE,CAAAf,QAAA,eACAP,IAAA,CAACJ,OAAO,EAAC2B,IAAI,CAAC,IAAI,CAACC,KAAK,CAAC,SAAS,CAAE,CAAC,cACrCxB,IAAA,QAAKgB,KAAK,CAAE,CAAEQ,KAAK,CAAE,SAAS,CAAEC,QAAQ,CAAE,MAAO,CAAE,CAAAlB,QAAA,CAAC,yCAAS,CAAK,CAAC,EAChE,CAAC,CAEV,CAEA,GAAI,CAACV,eAAe,CAAC,CAAC,EAAI,CAACa,OAAO,CAAE,CAClC,mBAAOV,IAAA,CAACL,QAAQ,EAAC+B,EAAE,CAAC,cAAc,CAACC,OAAO,MAAE,CAAC,CAC/C,CAEA,mBAAO3B,IAAA,CAAAI,SAAA,EAAAG,QAAA,CAAGA,QAAQ,CAAG,CAAC,CACxB,CAAC,CAED,cAAe,CAAAF,cAAc","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}